---
title: "TUS_analysis_behavioral data"
author: "nomi"
date: '2022-09-23'
output: html_document
---


```{r setup, include=FALSE}
#git_remotes()
```

```{r}
#library(usethis)
#use_github()
```


#### LOAD LIBRARIES
```{r}
library(pacman)
p_load(tidyverse, BayesFactor, lmerTest, rms, htmltools, bridgesampling, rstanarm,dplyr, magrittr, ggplot())

# parnsip
```


#### Insert .txt files
```{r}

pilot<- tibble(filename = list.files("pilot data", "*.txt", full.names=TRUE)) %>% 
  group_by(filename) %>% 
  do(read.table(.$filename))


#log <- read.table(file = "MRGI0033_log.txt", header = FALSE)

```



#### Set variable names
```{r}
pilot <- pilot %>% set_names(c("ID", "stim_ID", "GW", "GAL", "NGW", "NGL", "jitter1", 
              "jitter2", "RT", "outcomefeed"))

pilot %>% glimpse

```


#### Change name of ID rows to match the subj_ID (i.e.  "pilot data/DBGE0324_log.txt" --> "DBGE0324")
```{r}
library(stringr)
pilot <- pilot %>%
      mutate_at("ID", str_replace, "pilot data/", "")# & "log.txt", "")

pilot <- pilot %>%
      mutate_at("ID", str_replace, "_log.txt", "")

pilot %>% glimpse
```
#### Trial for a neat version of the above chunk. No luck at the moment. 
```{r}
#pilot <- pilot %>%
     # mutate_at("ID", str_replace, "pilot data/" and "_log.txt", "")

#replace multiple words in the ID column
           #pilot$ID <- str_replace_all(pilot$ID, c("pilot data/" = "", "_log.txt"= ""))
           #pilot$ID %>% glimpse

#pilot$ID <- case_when(
#   pilot$ID == "pilot data/"~ "",
#    pilot$ID == "_log.txt"~ "",
#    TRUE ~ NA
#)

```


#### Add response col (press - no_press)
```{r}
pilot$response <- with(pilot, ifelse(RT>0, "press", "no_press"))
      
        
```

#### Add GNG col (Go-noGO)
```{r}
pilot$GNG <- ifelse(pilot$stim_ID == pilot$NGL, 'noGo',
                ifelse(pilot$stim_ID == pilot$NGW, 'noGo', 'Go'))     
        
```
 

#### Add correct column (0-1)  
```{r}
pilot <- pilot %>%
  mutate(correct = ifelse(GNG == "noGo", ifelse(response == "no_press", 1, 0), 
         
                    ifelse(GNG == "Go", ifelse(response == "press", 1, 0), 1)))

```
        
       


#### Add win_lose column (win - lose) 
```{r}
pilot$win_lose_neutral <- recode_factor(pilot$outcomefeed, "-1" = "lose", 
                                "1" = "win", "0"= "neutral")
View(pilot)
```
      
      
### Add Cue column (if stim_ID=NGW then NGW, etc. for  NGL, GW, GAL)
```{r}
pilot$Cue <- ifelse(pilot$stim_ID == pilot$NGL, 'NGL',
                ifelse(pilot$stim_ID == pilot$NGW, 'NGW', 
                ifelse(pilot$stim_ID == pilot$GW, 'GW', 
              ifelse(pilot$stim_ID == pilot$GAL, 'GAL', NA)))) 
                     

    ```

###Trial column - and block column
```{r}
#1,2,3...100...400
pilot <- pilot %>%
  group_by(ID) %>%
  mutate(trial_number = row_number())


#block 1, 2, 3, 4
pilot$block <- ifelse(pilot$trial_number == 1:100, '1',
                ifelse(pilot$trial_number == 101:200, '2', 
                ifelse(pilot$trial_number == 201:300, '3', 
              ifelse(pilot$trial_number == 301:400, '4', NA))))
                         View(pilot)

```


 #### Distribution of RT for presses
```{r}

 #MEAN RT - PRESSES (distribution of RT)
pilot_presses <- subset(pilot, RT != "0") # exlude 0s (no presses)
RTs_presses <-pilot_presses%>%  group_by(RT, ID, outcomefeed) %>% 
  summarise(Mean_RT = mean(RT, na.rm = TRUE)) #%>%
 # filter(CorrectResponse == "Correct")

p1 <-ggplot(data = RTs_presses, 
       aes(x = Mean_RT)) + 
  geom_histogram()

p1 +ggtitle ("Distribution of RT for presses")

  #MEAN rt - correct
#RTs_correct <-pilot %>% group_by(Cue) %>% 
#summarise(Mean_RT = percent = 100 * n() / nrow( RT ) )# %>%
# filter(correct == "1")


#ggplot(data = RTs_correct, 
  #     aes(x = Mean_RT)) + 
 # geom_histogram()

```

#### Number of presses vs no_presses - needs wooork
```{r}
pilot%>% group_by (Cue)%>% dplyr::count(response) %>% filter(response == "press")

ggplot(pilot %>% 
   filter(response == "press"), aes(x=Cue, y= response)) + 
  geom_bar(stat = "identity")


ggplot(pilot %>% 
   filter(response == "no_press"), aes(x=Cue, y= response)) + 
  geom_bar(stat = "identity")

#mess press vs no press? general?
ggplot(pilot %>%
         group_by(Cue),
         aes(x=response)) + 
          geom_bar(stat = "count")

#not quite yet
ggplot(pilot%>%
         group_by(RT),
         aes(x=Cue, y=response)) + 
          geom_bar(stat = "Identity")

#this is good 
ggplot(pilot%>%       
       filter(response != "no_press"),
        aes(x = Cue,                                 
            y =  RT,                                  
            group = response,                                 
            color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")



####try number of times == press / times cue presented!!!!
ggplot(pilot,   
        aes(x = Cue,                                 
            y =  response))+                                 
            #group = response,                                 
           # color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")

-----------------------
pilot / rowSums(pilot) * 100

BCI_percent2 <- BCI_plus %>%
gather(key = taxon, value = count, -siteID) %>% #make into thin format
group_by(siteID) %>% #do calculations by siteID
mutate(percent = count / sum(count) * 100)
 
head(BCI_percent2 %>% filter(count > 0))# show some data
#RTs_correct <-pilot %>% group_by(Cue) %>% 
#summarise(Mean_RT = percent = 100 * n() / nrow( RT ) )# %>%
# filter(correct == "1")
ggplot(pilot,
       summarise(response = 100 *  dplyr::n() / nrow(RT)),
        aes(x = Cue,                                 
            y =  response)+
            #group = response,                                 
           # color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar"))#+


#find how to have both in one graph, presses and no presses (easy but think about it for a nice graph)
```

### Numbers of Go vs noGO responses
```{r}
ggplot(pilot%>%
         group_by(GNG),
       aes(x=win_lose_neutral, y= GNG))+ 
  geom_bar(stat = "identity")


ggplot(pilot,
        aes(x = Cue,                                 
            y =  response,                                  
            group = GNG,                                 
            color = GNG)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+


ggplot(pilot,
        aes(x = response,                                 
            y =  Cue,                                
            group = response,                                 
           color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+



###that shows a
ggplot(pilot%>%
         filter(response != "no_press"),
        aes(x = response,                                 
            y =  GNG,                                
            group = Cue,                                 
           color = Cue)) +  
  geom_jitter()

```

