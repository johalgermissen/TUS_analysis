---
title: "TUS_analysis_behavioral data"
author: "nomi"
date: '2022-09-23'
output: html_document
---


```{r setup, include=FALSE}
#git_remotes()
```

```{r}
#library(usethis)
#use_github()
```


#### LOAD LIBRARIES
```{r}
library(pacman)
p_load(tidyverse, BayesFactor, lmerTest, rms, htmltools, bridgesampling, rstanarm,dplyr, magrittr, ggplot())

# parnsip
```


#### Insert .txt files
```{r}

pilot<- tibble(filename = list.files("pilot data", "*.txt", full.names=TRUE)) %>% 
  group_by(filename) %>% 
  do(read.table(.$filename))


#log <- read.table(file = "MRGI0033_log.txt", header = FALSE)

```



#### Set variable names
```{r}
pilot <- pilot %>% set_names(c("ID", "stim_ID", "GW", "GAL", "NGW", "NGL", "jitter1", 
              "jitter2", "RT", "outcomefeed"))

pilot %>% glimpse

```


#### Change name of ID rows to match the subj_ID (i.e.  "pilot data/DBGE0324_log.txt" --> "DBGE0324")
```{r}
library(stringr)
pilot <- pilot %>%
      mutate_at("ID", str_replace, "pilot data/", "")# & "log.txt", "")

pilot <- pilot %>%
      mutate_at("ID", str_replace, "_log.txt", "")

pilot %>% glimpse
```
#### Trial for a neat version of the above chunk. No luck at the moment. 
```{r}
#pilot <- pilot %>%
     # mutate_at("ID", str_replace, "pilot data/" and "_log.txt", "")

#replace multiple words in the ID column
           #pilot$ID <- str_replace_all(pilot$ID, c("pilot data/" = "", "_log.txt"= ""))
           #pilot$ID %>% glimpse

#pilot$ID <- case_when(
#   pilot$ID == "pilot data/"~ "",
#    pilot$ID == "_log.txt"~ "",
#    TRUE ~ NA
#)

```


#### Add response col (press - no_press)
```{r}
pilot$response <- with(pilot, ifelse(RT>0, "press", "no_press"))
      
        
```

#### Add GNG col (Go-noGO)
```{r}
pilot$GNG <- ifelse(pilot$stim_ID == pilot$NGL, 'noGo',
                ifelse(pilot$stim_ID == pilot$NGW, 'noGo', 'Go'))     
        
```
 

#### Add correct column (0-1)  
```{r}
pilot <- pilot %>%
  mutate(correct = ifelse(GNG == "noGo", ifelse(response == "no_press", 1, 0), 
         
                    ifelse(GNG == "Go", ifelse(response == "press", 1, 0), 1)))

```
        
       


#### Add win_lose column (win - lose) 
```{r}
pilot$win_lose_neutral <- recode_factor(pilot$outcomefeed, "-1" = "lose", 
                                "1" = "win", "0"= "neutral")
View(pilot)
```
      
      
### Add Cue column (if stim_ID=NGW then NGW, etc. for  NGL, GW, GAL)
```{r}
pilot$Cue <- ifelse(pilot$stim_ID == pilot$NGL, 'NGL',
                ifelse(pilot$stim_ID == pilot$NGW, 'NGW', 
                ifelse(pilot$stim_ID == pilot$GW, 'GW', 
              ifelse(pilot$stim_ID == pilot$GAL, 'GAL', NA)))) 
                     

    ```

###Trial column and block column
```{r}
#1,2,3...100...400
pilot <- pilot %>%
  group_by(ID) %>%
  mutate(trial_number = row_number())


#block 1, 2, 3, 4
pilot$block <- ifelse(pilot$trial_number == 1:100, '1',
                ifelse(pilot$trial_number == 101:200, '2', 
                ifelse(pilot$trial_number == 201:300, '3', 
              ifelse(pilot$trial_number == 301:400, '4', NA))))
                         View(pilot)

```

###ow many 'Go' responses ppl performed for each of the 4 stimuli, just like that plot from the paper. I was thinking to figure this out it might make it easier to have 4 new columns each with how many Go responses for each stimuli.



 #### Distribution of RT for presses
```{r}

 #MEAN RT - PRESSES (distribution of RT)
pilot_presses <- subset(pilot, RT != "0") # exlude 0s (no presses)
RTs_presses <-pilot_presses%>%  group_by(RT, ID, outcomefeed) %>% 
  summarise(Mean_RT = mean(RT, na.rm = TRUE)) #%>%
 # filter(CorrectResponse == "Correct")

p1 <-ggplot(data = RTs_presses, 
       aes(x = Mean_RT)) + 
  geom_histogram()

p1 +ggtitle ("Distribution of RT for presses")

```


#### Number of presses vs no_presses 
###How many 'Go' responses ppl performed for each of the 4 stimuli, just like that plot from the paper. I was thinking to figure this out it might make it easier to have 4 new columns each with how many Go responses for each stimuli.
```{r}
pilot%>% group_by (Cue)%>% dplyr::count(response) %>% filter(response == "press")

#they fluctuate a lot per participant the presses for the noGo responses
presses_per_Cue<- pilot%>% group_by (Cue, ID)%>% dplyr::count(response) %>% filter(response == "press")
View (presses_per_Cue)

presses_per_Cue_block<- pilot%>% group_by (Cue, block)%>% dplyr::count(response) %>% filter(response == "press")
View (presses_per_Cue_block)

ggplot(pilot %>% 
   filter(response == "press"), aes(x=Cue, y= response)) + 
  geom_bar(stat = "identity")

# press vs no press, per Cue better
ggplot(pilot %>%
         group_by(Cue),
         aes(x=response,
             group = Cue,                                 
            color = Cue, fill = Cue)) + 
          geom_bar(stat = "count")

# press per Cue per block
ggplot(pilot %>%
        filter(response == "press"),
         aes(y = block,
             group = Cue,                                 
            color = Cue, fill = Cue)) + 
     # facet_grid(Cue~paste("cue", Cue), scales="free")
          geom_bar(stat = "count")
          
```



###Neutral > win > lose
```{r}
pilot%>% group_by(win_lose_neutral) %>%dplyr::count(win_lose_neutral) 

ggplot(pilot,#%>%
        # group_by(GNG),
       aes(x=win_lose_neutral, y= GNG))+ 
  geom_bar(stat = "identity")



#presses per cue valence (win, lose, neutral)
pilot%>% group_by(win_lose_neutral, response) %>%dplyr::count(win_lose_neutral) 

ggplot(pilot,
       aes(x=win_lose_neutral,
           color = response, fill = response))+ 
  geom_bar(stat = "count")
```

###Presses per correctness and blocks and response (press vs no_press)
```{r}
#presses per correct and blocks--> they are doing good so far. they learn fast
pilot%>% group_by(correct, response) %>%dplyr::count(correct) 
pilot%>% group_by(correct, block) %>%dplyr::count(correct) # 1st block OK, 2nd block better, 3rd block tired, 4th block better

#How good per block and per response (press vs no_press)
ggplot(pilot,
        aes(x = response,                                 
            y =  correct,                                
            group = block,                                 
           color = block)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")

#How good per block
ggplot(pilot,
        aes(x = block,                                 
            y =  correct,                                
            group = block,                                 
           color = block)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +        
   stat_summary(fun.data = "mean_se", geom = "errorbar")

```

###  Go xxxxxxxxxxxxxxxxxxx
```{r}
glimpse (pilot)

        pilot %>%
          group_by(block, Cue)%>%
        # filter(response == "press")%>%
         summarise(correct=sum(correct))%>%
        ggplot(aes(x = block            ,                                 
             y = correct,
             group = Cue,                                 
             color = Cue, fill = Cue))+                                 
        geom_line()

         prop.table(table (pilot$response))
        
         pilot %>%
          group_by(block, Cue, response)%>%
         filter(response == "press")%>%
           prop.table(table (pilot$response))%>%
        ggplot(aes(x = block            ,                                 
             y = response,
             group = Cue,                                 
             color = Cue, fill = Cue))+                                 
 stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+



ggplot(pilot,
        aes(x = response,                                 
            y =  Cue,                                
            group = response,                                 
           color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+



###that shows a
ggplot(pilot%>%
         filter(response != "no_press"),
        aes(x = response,                                 
            y =  GNG,                                
            group = Cue,                                 
           color = Cue)) +  
  geom_jitter()

```


#not quite yet
ggplot(pilot%>%
         group_by(RT),
         aes(x=Cue, y=response)) + 
          geom_bar(stat = "Identity")

#this is good 
ggplot(pilot%>%       
       filter(response != "no_press"),
        aes(x = Cue,                                 
            y =  RT,                                  
            group = response,                                 
            color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")

#not so bad
ggplot(pilot%>%  
         filter(response != "no_press")%>%
         group_by(block),
        aes(x = Cue,                                 
            y =  RT,                                  
            group = block,                                 
            color = block)) +                              
     stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")
####try number of times == press / times cue presented!!!!



ggplot(pilot,   
        aes(x = Cue,                                 
            y =  response))+                                 
            #group = response,                                 
           # color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")

-----------------------
pilot / rowSums(pilot) * 100

BCI_percent2 <- BCI_plus %>%
gather(key = taxon, value = count, -siteID) %>% #make into thin format
group_by(siteID) %>% #do calculations by siteID
mutate(percent = count / sum(count) * 100)
 
#RTs_correct <-pilot %>% group_by(Cue) %>% 
#summarise(Mean_RT = percent = 100 * n() / nrow( RT ) )# %>%
# filter(correct == "1")
ggplot(pilot,
       summarise(response = 100 *  n() / nrow(400)),
        aes(x = Cue,                                 
            y =  response)+
            #group = response,                                 
           # color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar"))#+


#find how to have both in one graph, presses and no presses (easy but think about it for a nice graph)
```

### Numbers of Go vs noGO responses
```{r}
ggplot(pilot%>%
         group_by(GNG),
       aes(x=win_lose_neutral, y= GNG))+ 
  geom_bar(stat = "identity")


ggplot(pilot,
        aes(x = Cue,                                 
            y =  response,                                  
            group = GNG,                                 
            color = GNG)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+


ggplot(pilot,
        aes(x = response,                                 
            y =  Cue,                                
            group = response,                                 
           color = response)) +                              
   stat_summary(fun = "mean", geom = "point") +        
   stat_summary(fun = "mean", geom = "line") +         
   stat_summary(fun.data = "mean_se", geom = "errorbar")#+



###that shows a
ggplot(pilot%>%
         filter(response != "no_press"),
        aes(x = response,                                 
            y =  GNG,                                
            group = Cue,                                 
           color = Cue)) +  
  geom_jitter()

```


playinng
```{r}
ggplot(pilot%>%
         filter(response != "no_press")%>%
         group_by(block),
        aes(x = block,                                 
            y =  Cue,                                
            group = correct,                                 
           color = correct)) +  
  geom_jitter()


#error
pilot$p <- prop.table(table(pilot$correct), margin=1)

ggplot(as.data.frame(p), aes(x = Cue, y = response, fill = Var1)) + 
  geom_bar(stat="identity", position = "dodge")

#error
ggplot(pilot%>%
              filter(response != "no_press"),
              aes(x = Cue,
                  y = response,
                  fill = correct)) +
  geom_bar(position = "fill", stat = "identity")
ggp     



library(ggthemes)

data.frame(pilot)
 ggplot (pilot%>%
      aes(x = response, y = correct, fill = Cue)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +  
  scale_y_continuous(labels = scales::percent)+ 
  scale_fill_few('Medium', drop = FALSE) +              # keep levels, if data is filtered
  labs(x = 'response', y = NULL, fill = 'Cue')#,
       # title = 'Proportions in Sub-groups by Group') 
```



